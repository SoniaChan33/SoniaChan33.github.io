<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.shan33.cn","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="引入1. 概念JDBC（Java DataBase Connectivity,  Java数据库连接) ,是一种用于执行SQL语句的Java API，为多种关系数据库提供统一访问,它由一组用Java语言编写的类和接口组成">
<meta property="og:type" content="article">
<meta property="og:title" content="JDBC">
<meta property="og:url" content="http://www.shan33.cn/2021/06/07/JDBC/index.html">
<meta property="og:site_name" content="Sonia33&#39;s Blog">
<meta property="og:description" content="引入1. 概念JDBC（Java DataBase Connectivity,  Java数据库连接) ,是一种用于执行SQL语句的Java API，为多种关系数据库提供统一访问,它由一组用Java语言编写的类和接口组成">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704112134.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704112049.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704123012.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/06/07/JDBC/20210705111903.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704145529.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704145550.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704150456.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704153100.png">
<meta property="og:image" content="c:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20210705110755222.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210705182201.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210706143739.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210706143810.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210706152659.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210707200554.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210709153202.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711103201.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711185528.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711190848.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711190953.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711191448.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711192110.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711192336.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711192550.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711193622.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210711193523.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712101026.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712110521.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712120555.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712120643.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712124734.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712125136.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712122737.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712123200.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712124134.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712124306.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712124525.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153337.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153335.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153333.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153328.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153331.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153325.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153312.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712153317.png">
<meta property="og:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210712154207.png">
<meta property="article:published_time" content="2021-06-07T01:47:10.000Z">
<meta property="article:modified_time" content="2022-05-07T02:07:45.635Z">
<meta property="article:author" content="Sonia33">
<meta property="article:tag" content="JDBC">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="DataBase">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.shan33.cn/2021/06/07/JDBC/20210704112134.png">


<link rel="canonical" href="http://www.shan33.cn/2021/06/07/JDBC/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.shan33.cn/2021/06/07/JDBC/","path":"2021/06/07/JDBC/","title":"JDBC"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>JDBC | Sonia33's Blog</title>
  




<link rel="stylesheet" type="text/css" href="/css/injector/main.css" /><link rel="preload" as="style" href="/css/injector/light.css" /><link rel="preload" as="style" href="/css/injector/dark.css" />
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Sonia33's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Sonia33's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%95%E5%85%A5"><span class="nav-number">1.</span> <span class="nav-text">引入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">1. 概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.</span> <span class="nav-text">2. 依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.1.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.2.</span> <span class="nav-text">移除依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.3.</span> <span class="nav-text">3. 实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%9A%E5%8A%A0%E8%BD%BD%E4%B8%80%E4%B8%AADriver%E9%A9%B1%E5%8A%A8"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">1：加载一个Driver驱动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%EF%BC%88Connection%EF%BC%89"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">2：创建数据库连接（Connection）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%9A%E5%88%9B%E5%BB%BASQL%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81%E5%99%A8Statement"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">3：创建SQL命令发送器Statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%9A%E9%80%9A%E8%BF%87Statement%E5%8F%91%E9%80%81SQL%E5%91%BD%E4%BB%A4%E5%B9%B6%E5%BE%97%E5%88%B0%E7%BB%93%E6%9E%9C"><span class="nav-number">1.3.0.4.</span> <span class="nav-text">4：通过Statement发送SQL命令并得到结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%9A%E5%85%B3%E9%97%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B5%84%E6%BA%90ResultSet-Statement-Connection"><span class="nav-number">1.3.0.5.</span> <span class="nav-text">5：关闭数据库资源ResultSet  Statement  Connection</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BC%82%E5%B8%B8%E5%88%86%E6%9E%90"><span class="nav-number">1.4.</span> <span class="nav-text">4. 常见的异常分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%8A%A0%E8%BD%BD"><span class="nav-number">2.</span> <span class="nav-text">1. 驱动的加载</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">2. 添加异常处理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-JDBC%E5%AE%8C%E6%88%90CURD"><span class="nav-number">4.</span> <span class="nav-text">3. JDBC完成CURD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%92%8C%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C"><span class="nav-number">4.0.1.</span> <span class="nav-text">删除和修改操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="nav-number">4.0.2.</span> <span class="nav-text">查询操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">4.0.2.1.</span> <span class="nav-text">完整代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%B0%81%E8%A3%85%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="nav-number">4.0.3.</span> <span class="nav-text">创建实体类封装结果集</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Emp-java"><span class="nav-number">4.0.3.1.</span> <span class="nav-text">Emp.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TestJDBC-java"><span class="nav-number">4.0.3.2.</span> <span class="nav-text">TestJDBC.java</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="nav-number">4.0.3.2.1.</span> <span class="nav-text">完整代码</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E9%A2%84%E7%BC%96%E8%AF%91PreparedStatement"><span class="nav-number">5.</span> <span class="nav-text">4. 预编译PreparedStatement</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5%E6%9D%A5%E9%A2%84%E9%98%B2SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="nav-number">5.1.</span> <span class="nav-text">使用预编译语句来预防SQL注入攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95"><span class="nav-number">5.1.0.1.</span> <span class="nav-text">模拟登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="nav-number">5.1.0.2.</span> <span class="nav-text">注入攻击</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5%E6%9D%A5%E9%A2%84%E9%98%B2"><span class="nav-number">5.1.0.3.</span> <span class="nav-text">通过预编译语句来预防</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-number">5.2.</span> <span class="nav-text">预编译的原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E5%BC%80%E5%90%AF"><span class="nav-number">5.2.1.</span> <span class="nav-text">预编译的开启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">5.2.2.</span> <span class="nav-text">优点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E5%AE%9E%E7%8E%B0CURD"><span class="nav-number">5.3.</span> <span class="nav-text">预编译实现CURD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TestPreparedStatement-java"><span class="nav-number">5.3.0.1.</span> <span class="nav-text">TestPreparedStatement.java</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%89%B9%E5%A4%84%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">5. 批处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5"><span class="nav-number">6.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statement%E5%92%8CpreparedStatement%E7%9A%84%E6%89%B9%E5%A4%84%E7%90%86%E5%8C%BA%E5%88%AB"><span class="nav-number">6.2.</span> <span class="nav-text">Statement和preparedStatement的批处理区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E5%BC%80%E5%90%AF"><span class="nav-number">6.3.</span> <span class="nav-text">批处理开启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.4.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-JDBC%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1"><span class="nav-number">7.</span> <span class="nav-text">6.JDBC控制事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%BA%8B%E5%8A%A1%E6%89%8B%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="nav-number">7.0.1.</span> <span class="nav-text">设置事务手动提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%9E%E6%BB%9A%E7%82%B9"><span class="nav-number">7.0.2.</span> <span class="nav-text">设置回滚点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-DAO%E6%A8%A1%E5%BC%8F"><span class="nav-number">8.</span> <span class="nav-text">7. DAO模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E7%B1%BB%EF%BC%88DAO%E5%B1%82%EF%BC%89"><span class="nav-number">8.1.</span> <span class="nav-text">接口类（DAO层）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Emp-java-1"><span class="nav-number">8.1.1.</span> <span class="nav-text">Emp.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dept-java"><span class="nav-number">8.1.2.</span> <span class="nav-text">Dept.java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%88%E6%9C%AA%E8%A2%AB%E6%8A%BD%E5%8F%96%E7%9A%84%EF%BC%89"><span class="nav-number">8.2.</span> <span class="nav-text">实现类（未被抽取的）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EmpDaoImpl-java"><span class="nav-number">8.2.1.</span> <span class="nav-text">EmpDaoImpl.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DeptDaoImpl-java"><span class="nav-number">8.2.2.</span> <span class="nav-text">DeptDaoImpl.java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">8.3.</span> <span class="nav-text">员工管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EmpManageSystem-java"><span class="nav-number">8.3.1.</span> <span class="nav-text">EmpManageSystem.java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BaseDao%E6%8A%BD%E5%8F%96"><span class="nav-number">8.4.</span> <span class="nav-text">BaseDao抽取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E7%9A%84%E6%8A%BD%E5%8F%96%E2%80%93baseUpdate"><span class="nav-number">8.4.1.</span> <span class="nav-text">增删改的抽取–baseUpdate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%8A%BD%E5%8F%96%E2%80%93baseQuery"><span class="nav-number">8.4.2.</span> <span class="nav-text">查询的抽取–baseQuery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%B1%BB%E7%AE%80%E5%8C%96%E7%BB%93%E6%9E%9C"><span class="nav-number">8.4.3.</span> <span class="nav-text">实现类简化结果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DeptDaoImpl-java-1"><span class="nav-number">8.4.3.1.</span> <span class="nav-text">DeptDaoImpl.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EmpDaoImpl-java-1"><span class="nav-number">8.4.3.2.</span> <span class="nav-text">EmpDaoImpl.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">8.4.3.3.</span> <span class="nav-text">错误总结：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">8.5.</span> <span class="nav-text">连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">8.5.1.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseDao%E6%94%B9%E8%BF%9B"><span class="nav-number">8.5.2.</span> <span class="nav-text">BaseDao改进</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BaseDao-java"><span class="nav-number">8.5.2.1.</span> <span class="nav-text">BaseDao.java</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">8.6.</span> <span class="nav-text">配置文件优化连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PropertiesUtil%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">8.6.1.</span> <span class="nav-text">PropertiesUtil工具类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BC%98%E5%8C%96"><span class="nav-number">8.6.2.</span> <span class="nav-text">连接池优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%80%BB%E7%BB%93"><span class="nav-number">8.6.3.</span> <span class="nav-text">错误总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-log4j%E6%97%A5%E5%BF%97"><span class="nav-number">9.</span> <span class="nav-text">8. log4j日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%B8%BA%E4%BE%8B%EF%BC%9A"><span class="nav-number">9.0.1.</span> <span class="nav-text">以连接池为例：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">9.0.2.</span> <span class="nav-text">补充</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F"><span class="nav-number">10.</span> <span class="nav-text">9. 三大范式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F%EF%BC%881NF%EF%BC%89"><span class="nav-number">10.1.</span> <span class="nav-text">第一范式（1NF）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F%EF%BC%882NF%EF%BC%89"><span class="nav-number">10.2.</span> <span class="nav-text">第二范式（2NF）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F%EF%BC%883NF%EF%BC%89"><span class="nav-number">10.3.</span> <span class="nav-text">第三范式（3NF）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">10.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sonia33"
      src="/images/iu.png">
  <p class="site-author-name" itemprop="name">Sonia33</p>
  <div class="site-description" itemprop="description">不念过去，不惧未来</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/soniachan33" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soniachan33" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:soniachan33@163.com" title="E-Mail → mailto:soniachan33@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/weixin_43633620?spm=1000.2115.3001.5343" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_43633620?spm&#x3D;1000.2115.3001.5343" rel="noopener" target="_blank"><i class="fa fa-book-open fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/360939620" title="bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;360939620" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5160074037" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5160074037" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



        </div>
      </div>
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=467590816&auto=1&height=66"></iframe>









      <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()",1000);
BirthDay=new Date("05/6/2022 15:13:14");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>
    </div>
    
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.shan33.cn/2021/06/07/JDBC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/iu.png">
      <meta itemprop="name" content="Sonia33">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sonia33's Blog">
      <meta itemprop="description" content="不念过去，不惧未来">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="JDBC | Sonia33's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JDBC
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-07 09:47:10" itemprop="dateCreated datePublished" datetime="2021-06-07T09:47:10+08:00">2021-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-07 10:07:45" itemprop="dateModified" datetime="2022-05-07T10:07:45+08:00">2022-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h1><h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h2><p><strong>JDBC</strong>（Java DataBase Connectivity,  Java数据库连接) ,是一种用于执行SQL语句的Java API，为多种关系数据库提供统一访问,它由一组用Java语言编写的类和接口组成</p>
<span id="more"></span>

<h2 id="2-依赖"><a href="#2-依赖" class="headerlink" title="2. 依赖"></a>2. 依赖</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><p>src下创建一个文件夹命名lib，然后把依赖包复制到里面，右键create library</p>
<img src="/2021/06/07/JDBC/20210704112134.png" alt="image-20210704112134768" style="zoom:50%;">

<h3 id="移除依赖"><a href="#移除依赖" class="headerlink" title="移除依赖"></a>移除依赖</h3><p>setting ——&gt;project structure</p>
<img src="/2021/06/07/JDBC/20210704112049.png" alt="image-20210704112049391" style="zoom: 33%;">

<h2 id="3-实例"><a href="#3-实例" class="headerlink" title="3. 实例"></a>3. 实例</h2><h4 id="1：加载一个Driver驱动"><a href="#1：加载一个Driver驱动" class="headerlink" title="1：加载一个Driver驱动"></a>1：加载一个Driver驱动</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.加载驱动 Driver</span></span><br><span class="line"><span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver();</span><br></pre></td></tr></table></figure>

<h4 id="2：创建数据库连接（Connection）"><a href="#2：创建数据库连接（Connection）" class="headerlink" title="2：创建数据库连接（Connection）"></a>2：创建数据库连接（Connection）</h4><ul>
<li><p>url</p>
<p>格式——协议**://<strong>ip</strong>:<strong>端口/资源路径</strong>?<strong>参数名</strong>=<strong>参数值</strong>&amp;<strong>参数名=参数值</strong>&amp;….**</p>
<ul>
<li>协议         jdbc:mysql</li>
<li>IP          127.0.0.1/localhost</li>
<li>端口号       3306<ul>
<li>数据库名字   mydb</li>
<li>参数  useSSL(是否使用SSL)、useUnicode(是否使用unicod)、characterEncoding(使用unicode类型)、serverTimezone(时区)</li>
</ul>
</li>
</ul>
</li>
<li><p>user</p>
</li>
<li><p>password</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.获得链接</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 传入三个参数：url，user，password</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/ShangHai&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,user,password);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3：创建SQL命令发送器Statement"><a href="#3：创建SQL命令发送器Statement" class="headerlink" title="3：创建SQL命令发送器Statement"></a>3：创建SQL命令发送器Statement</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.获得语句对象statement</span></span><br><span class="line"><span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br></pre></td></tr></table></figure>

<h4 id="4：通过Statement发送SQL命令并得到结果"><a href="#4：通过Statement发送SQL命令并得到结果" class="headerlink" title="4：通过Statement发送SQL命令并得到结果"></a>4：通过Statement发送SQL命令并得到结果</h4><p><strong>statement.executeUpdate</strong> 在sql操作insert、delete、update时使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.执行SQL语句，返回结果</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(50,&#x27;教学部&#x27;,&#x27;BeiJing&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> statement.executeUpdate(sql); <span class="comment">//insert delete update</span></span><br><span class="line">System.out.println(<span class="string">&quot;影响行数为&quot;</span>+ row);</span><br></pre></td></tr></table></figure>

<h4 id="5：关闭数据库资源ResultSet-Statement-Connection"><a href="#5：关闭数据库资源ResultSet-Statement-Connection" class="headerlink" title="5：关闭数据库资源ResultSet  Statement  Connection"></a>5：关闭数据库资源ResultSet  Statement  Connection</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//6.释放资源</span></span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure>

<p>结果</p>
<img src="/2021/06/07/JDBC/20210704123012.png" alt="image-20210704123012385" style="zoom:50%;">

<h2 id="4-常见的异常分析"><a href="#4-常见的异常分析" class="headerlink" title="4. 常见的异常分析"></a>4. 常见的异常分析</h2><p>MySQL8中数据库连接的四个参数有两个发生了变化</p>
<p>String driver = “com.mysql.cj.jdbc.Driver”;</p>
<p>String url = “jdbc:mysql://127.0.0.1:3306/mydb?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai”;</p>
<p>或者String url = “…….serverTimezone=GMT%2B8”;</p>
<ul>
<li><strong>错误1：Exception in thread “main” java.lang.ClassNotFoundException: com.mysql.jdbc2.Driver</strong></li>
</ul>
<p>原因：没有添加jar包或者com.mysql.jdbc2.Driver路径错误</p>
<ul>
<li><strong>错误2：Exception in thread “main” java.sql.SQLException:No suitable driver found for jbdc:mysql://127.0.0.1:3306/stumgr</strong></li>
</ul>
<p>原因：url错误</p>
<ul>
<li><strong>错误3：Exception in thread “main” java.sql.SQLException:</strong></li>
</ul>
<p>Access denied for user ‘root‘@’localhost’ (using password: YES)</p>
<p>原因：用户名或者密码错误</p>
<ul>
<li><strong>错误4：Exception in thread “main” com.mysql.jdbc.exceptions</strong></li>
<li><img src="/2021/06/07/JDBC/06/07/JDBC/20210705111903.png" class title="image-20210704153100091"></li>
</ul>
<p>.jdbc4.MySQLIntegrityConstraintViolationException:Duplicate entry ‘90’ for key ‘PRIMARY’</p>
<p>原因：主键冲突</p>
<ul>
<li><p><strong>错误5：Public Key Retrieval is not allowed</strong></p>
<p>如果用户使用 sha256_password 认证，密码在传输过程中必须使用 TLS 协议保护，但是如果 RSA 公钥不可用，可以使用服务器提供的公钥；可以在连接中通过 ServerRSAPublicKeyFile 指定服务器的 RSA 公钥，或者AllowPublicKeyRetrieval=True参数以允许客户端从服务器获取公钥；但是需要注意的是 AllowPublicKeyRetrieval=True可能会导致恶意的代理通过中间人攻击(MITM)获取到明文密码，所以默认是关闭的，必须显式开启<br>在jdbc连接添加上参数<strong>allowPublicKeyRetrieval=true</strong>即可，注意参数间用&amp;</p>
</li>
</ul>
<p>加参数allowPublicKeyRetrieval=true</p>
<h1 id="1-驱动的加载"><a href="#1-驱动的加载" class="headerlink" title="1. 驱动的加载"></a>1. 驱动的加载</h1><ul>
<li><p>在查看Driver的源代码时我们发现,该类内部有一个静态代码块,在代码块中就是在实例化一个驱动并在驱动中心注册.静态代码块会在类进入内存时执行,也就是说,我们只要让该类字节码进入内存,就会自动完成注册,不需要我们手动去new</p>
<img src="/2021/06/07/JDBC/20210704145529.png" alt="image-20210704145529583" style="zoom:50%;">

<img src="/2021/06/07/JDBC/20210704145550.png" alt="image-20210704145550511" style="zoom: 50%;"></li>
<li><p>可以通过反射来加载驱动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以通过反射来加载驱动</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>因为Driver类里面的静态代码块已经注册了驱动，就<strong>不用再单独注册驱动了</strong></p>
</li>
<li><p>查看jar包发现,jar包中已经默认配置了驱动类的加载，其实不需要手动加载，程序运行的时候也会自动加载jar包里的类</p>
<img src="/2021/06/07/JDBC/20210704150456.png" alt="image-20210704150456396" style="zoom:67%;"></li>
</ul>
<h1 id="2-添加异常处理"><a href="#2-添加异常处理" class="headerlink" title="2. 添加异常处理"></a>2. 添加异常处理</h1><img src="/2021/06/07/JDBC/20210704153100.png" alt="image-20210704153100091" style="zoom:67%;">

<p>将需要catch的异常部分 用快捷键<strong>ctrl+alt+T</strong>选择</p>
<img src="C:/Users/Dell/AppData/Roaming/Typora/typora-user-images/image-20210705110755222.png" alt="image-20210705110755222" style="zoom:50%;">

<p>把最后处理放在finally里面，分别加上try catch</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJDBC2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;<span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;<span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user= <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url,user,password);</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(50,&#x27;教学部&#x27;,&#x27;BeiJing&#x27;)&quot;</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br><span class="line">            System.out.println(<span class="string">&quot;影响行数为&quot;</span>+ row);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != statement)&#123; <span class="comment">//statement如果创建失败就不需要关了</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    statement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != connection)&#123;<span class="comment">// 同上</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-JDBC完成CURD"><a href="#3-JDBC完成CURD" class="headerlink" title="3. JDBC完成CURD"></a>3. JDBC完成CURD</h1><h3 id="删除和修改操作"><a href="#删除和修改操作" class="headerlink" title="删除和修改操作"></a>删除和修改操作</h3><p>和上面实例一样，只需要改sql语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from emp where deptno = 20 &quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update dept set dname = &#x27;总部&#x27;,loc=&#x27;BeiJing&#x27; where deptno = 30 &quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h3><ul>
<li>使用的方法是executeQuery()，返回的是一个结果集即表格被抽象成的对象 <strong>resultSet</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql); </span><br></pre></td></tr></table></figure>

<ul>
<li><p>循环获得每一列的数据：</p>
<p>**resultset.next()**：返回当前游标所指的行数据是否为空，如果为不为空，返回true，游标向下移动；为空则返回false，游标不移动</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (resultSet.next())&#123;<span class="comment">//判断游标是否为空</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">MGR</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;MGR&quot;</span>);</span><br><span class="line">    <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">    <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;SAL&quot;</span>);</span><br><span class="line">    <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;comm&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">    System.out.println(empno+<span class="string">&quot; &quot;</span>+ename+<span class="string">&quot; &quot;</span>+job+<span class="string">&quot; &quot;</span>+MGR+<span class="string">&quot; &quot;</span>+<span class="string">&quot; &quot;</span>+date+<span class="string">&quot; &quot;</span>+sal+<span class="string">&quot; &quot;</span>+comm+<span class="string">&quot; &quot;</span>+deptno);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ps: 获得的date对象不是util包的，而是sql包的对象</p>
<ul>
<li><p>关闭resultSet：</p>
<p>虽然 Statement 关闭、重新执行或用于从多结果序列中获取下一个结果时，ResultSet将被自动关闭，但是一个好的编程习惯很重要嘛，该关的还是要关。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="literal">null</span> != resultSet)&#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                  resultSet.close();</span><br><span class="line">              &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                  e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.chs.test01;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Class.forName;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-05 - 07 - 05 - 16:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.test01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJDBC4</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testQuery();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            forName(driver);</span><br><span class="line">            <span class="comment">//2.建立连接</span></span><br><span class="line">            connection = DriverManager.getConnection(url,user,password);</span><br><span class="line">            <span class="comment">//3.通过连接搭建statement</span></span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            <span class="comment">//4.操作sql</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">MGR</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;MGR&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;SAL&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;comm&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">                System.out.println(empno+<span class="string">&quot; &quot;</span>+ename+<span class="string">&quot; &quot;</span>+job+<span class="string">&quot; &quot;</span>+MGR+<span class="string">&quot; &quot;</span>+<span class="string">&quot; &quot;</span>+date+<span class="string">&quot; &quot;</span>+sal+<span class="string">&quot; &quot;</span>+comm+<span class="string">&quot; &quot;</span>+deptno);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//关闭resultSet</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != resultSet)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != statement)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    statement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != connection)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>结果：</p>
<img src="/2021/06/07/JDBC/20210705182201.png" alt="image-20210705182200681" style="zoom:50%;">

<h3 id="创建实体类封装结果集"><a href="#创建实体类封装结果集" class="headerlink" title="创建实体类封装结果集"></a>创建实体类封装结果集</h3><p>​    该实体类是和数据表格名称和字段是一一对应的类，该类主要用处是存储重数据库中查询出来的数据，除此之外该类无其他功能。</p>
<h4 id="Emp-java"><a href="#Emp-java" class="headerlink" title="Emp.java"></a>Emp.java</h4><p>要求：</p>
<ul>
<li>类名和表名保持一致</li>
<li>属性个数和表的列数保持一致</li>
<li>属性的数据类型和列的数据类型保持一致</li>
<li>属性名和表格列名保持一致</li>
<li>所有的属性都是私有的 （出于安全考虑）</li>
<li>实体类的属性推荐写成包装类 （例如int类型不能赋值为null）</li>
<li>日期类型建议使用java.util.Date(因为是父类,比较方便使用多态）</li>
<li>所有的属性都要有get和set方法</li>
<li>必须具备空参构造器</li>
<li>实体类需要实现序列化接口（mybatis 分布式）</li>
<li>实体类中其他构造方法可选</li>
<li>添加toString方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.chs.entity;</span><br><span class="line"><span class="keyword">import</span> com.sun.scenario.effect.impl.prism.PrRenderInfo;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;<span class="comment">//是java.sql.Date的父类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-05 - 07 - 05 - 19:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.entity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;<span class="comment">//实现序列化接口</span></span><br><span class="line">    <span class="keyword">private</span> Integer empno;</span><br><span class="line">    <span class="keyword">private</span> String ename;</span><br><span class="line">    <span class="keyword">private</span> String job;</span><br><span class="line">    <span class="keyword">private</span> Integer mgr;</span><br><span class="line">    <span class="keyword">private</span> Date hiredate;</span><br><span class="line">    <span class="keyword">private</span> Double sal;</span><br><span class="line">    <span class="keyword">private</span> Double comm;</span><br><span class="line">    <span class="keyword">private</span> Integer deptno;</span><br><span class="line">    <span class="comment">//可以有其他构造方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">(Integer empno, String ename, String job, Integer mgr, Date hiredate, Double sal, Double comm, Integer deptno)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.empno = empno;</span><br><span class="line">        <span class="built_in">this</span>.ename = ename;</span><br><span class="line">        <span class="built_in">this</span>.job = job;</span><br><span class="line">        <span class="built_in">this</span>.mgr = mgr;</span><br><span class="line">        <span class="built_in">this</span>.hiredate = hiredate;</span><br><span class="line">        <span class="built_in">this</span>.sal = sal;</span><br><span class="line">        <span class="built_in">this</span>.comm = comm;</span><br><span class="line">        <span class="built_in">this</span>.deptno = deptno;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//必须有空参构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//set和get方法省略</span></span><br><span class="line">    <span class="comment">//toSting省略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="TestJDBC-java"><a href="#TestJDBC-java" class="headerlink" title="TestJDBC.java"></a>TestJDBC.java</h4><p>修改—返回的是Emp的List集合对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Emp&gt; <span class="title function_">testQuery</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>main（）方法里面遍历输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//获得方法里返回的集合</span></span><br><span class="line">    List&lt;Emp&gt; emps = testQuery();</span><br><span class="line">    <span class="comment">//遍历集合</span></span><br><span class="line">    <span class="keyword">for</span>(Emp emp:emps)&#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-05 - 07 - 05 - 16:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.test01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJDBC4</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获得方法里返回的集合</span></span><br><span class="line">        List&lt;Emp&gt; emps = testQuery();</span><br><span class="line">        <span class="comment">//遍历集合</span></span><br><span class="line">        <span class="keyword">for</span>(Emp emp:emps)&#123;</span><br><span class="line">            System.out.println(emp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Emp&gt; <span class="title function_">testQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="literal">null</span>;<span class="comment">//emp对象的集合初始化</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url,user,password);</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">MGR</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;MGR&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;SAL&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;comm&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">                <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(empno, ename, job, MGR, date, sal, comm, deptno);<span class="comment">//构造每一行数据对象</span></span><br><span class="line">                list.add(emp);<span class="comment">//将每一行都放入集合中</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != resultSet)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != statement)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    statement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != connection)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;<span class="comment">//返回集合</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-预编译PreparedStatement"><a href="#4-预编译PreparedStatement" class="headerlink" title="4. 预编译PreparedStatement"></a>4. 预编译PreparedStatement</h1><h2 id="使用预编译语句来预防SQL注入攻击"><a href="#使用预编译语句来预防SQL注入攻击" class="headerlink" title="使用预编译语句来预防SQL注入攻击"></a>使用预编译语句来预防SQL注入攻击</h2><p>​        SQL注入攻击指的是通过构建<strong>特殊的输入</strong>作为<strong>参数</strong>传入<strong>Web应用程序</strong>，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。</p>
<h4 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h4><p>在前台输入用户名和密码，后台判断信息是否正确，并给出前台反馈信息，前台输出反馈信息。</p>
<p>具体实现步骤：</p>
<ul>
<li><p>创建数据库表</p>
<img src="/2021/06/07/JDBC/20210706143739.png" style="zoom:50%;"></li>
<li><p>创建实体类</p>
<img src="/2021/06/07/JDBC/20210706143810.png" alt="image-20210706143810882" style="zoom:50%;"></li>
<li><p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-06 - 07 - 06 - 14:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.test02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInjection</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> getAccount(username, pwd);</span><br><span class="line">        System.out.println(<span class="literal">null</span>!=account?(<span class="string">&quot;登录成功&quot;</span>+<span class="string">&quot;用户信息&quot;</span>+account):<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Account <span class="title function_">getAccount</span><span class="params">(String username,String pwd)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            forName(driver);</span><br><span class="line">            <span class="comment">//2.建立连接</span></span><br><span class="line">            connection = DriverManager.getConnection(url,user,password);</span><br><span class="line">            <span class="comment">//3.通过连接搭建statement</span></span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            <span class="comment">//4.操作sql</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from account where username = &#x27;&quot;</span>+username+<span class="string">&quot;&#x27;and password = &#x27;&quot;</span>+pwd+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">aid</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;aid&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">usernamea</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">pwda</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="type">Double</span> <span class="variable">balance</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line">                account = <span class="keyword">new</span> <span class="title class_">Account</span>(aid,usernamea,pwda,balance);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != resultSet)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != statement)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    statement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != connection)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> account;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2021/06/07/JDBC/20210706152659.png" alt="image-20210706152659400" style="zoom:50%;"></li>
</ul>
<h4 id="注入攻击"><a href="#注入攻击" class="headerlink" title="注入攻击"></a>注入攻击</h4><p>构建特殊的输入:</p>
<p>例如输入密码 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asdf&#x27;or&#x27;a&#x27;=&#x27;a</span><br></pre></td></tr></table></figure>

<p>整个sql语句就会变为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from account where username = &#x27;asdf&#x27; and password = &#x27;asdf&#x27;or&#x27;a&#x27;=&#x27;a&#x27;;</span><br></pre></td></tr></table></figure>

<p>导致含义改变。</p>
<h4 id="通过预编译语句来预防"><a href="#通过预编译语句来预防" class="headerlink" title="通过预编译语句来预防"></a>通过预编译语句来预防</h4><ul>
<li>使用PreparedStatement语句对象防止注入攻击<ul>
<li>PreparedStatement 可以使用 <strong>?</strong> 作为参数的占位符,即使是字符串和日期类型,也不使用单独再添加 <strong>‘ ‘</strong></li>
<li>connection.createStatement();获得的是普通语句对象 Statement<br>ction.prepareStatement(sql);可以获得一个预编译语句对象PreparedStatement</li>
<li>如果SQL语句中有?作为参数占位符号,那么要在执行CURD之前先设置参数<br>***(问号的编号,数据) 方法设置参数</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String sql=<span class="string">&quot;select * from account where username = ? and password = ?&quot;</span>;</span><br><span class="line">preparedStatement = connection.prepareStatement(sql);<span class="comment">//这里已经传入SQL语句</span></span><br><span class="line"><span class="comment">//设置参数</span></span><br><span class="line">preparedStatement.setString(<span class="number">1</span>,username );</span><br><span class="line">preparedStatement.setString(<span class="number">2</span>,pwd );</span><br><span class="line"><span class="comment">//执行CURD</span></span><br><span class="line">resultSet = preparedStatement.executeQuery();<span class="comment">// 这里不需要再传入SQL语句，传了会报错，亲身经历man</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<img src="/2021/06/07/JDBC/20210707200554.png" alt="image-20210707200553352" style="zoom:50%;">

<p>原理：</p>
<p>说白了就是把值当中的所有单引号给<strong>转义</strong>了!这就达到了防止sql注入的目的，说白了mysql驱动的PreparedStatement实现类的<strong>setString()</strong>;方法内部做了单引号的转义，而Statement不能防止sql注入，就是因为它没有把单引号做转义，而是简单粗暴的直接拼接字符串，所以达不到防止sql注入的目的。</p>
<h2 id="预编译的原理"><a href="#预编译的原理" class="headerlink" title="预编译的原理"></a>预编译的原理</h2><h3 id="预编译的开启"><a href="#预编译的开启" class="headerlink" title="预编译的开启"></a>预编译的开启</h3><p>值得注意的是,我们的Connector/J 5.0.5及之后useServerPrepStmts默认false,就是默认没有开启预编译,之前默认为true, cachePrepStmts 一直默认为false,需要我们手动设置才可以启用预编译,在开启预编译的同时要同时开启预编译缓存才能带来些许的性能提升.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;jdbc:mysql://localhost:3306/mydb?*****&amp;useServerPrepStmts=true&amp;cachePrepStmts=true&quot;</span>; </span><br></pre></td></tr></table></figure>

<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p>安全性高,可以避免SQL注入</p>
</li>
<li><p>简单不繁琐,不用进行字符串拼接</p>
</li>
<li><p>性能高，用在执行多个相同数据库DML操作时,可以减少sql语句的编译次数</p>
</li>
</ul>
<h2 id="预编译实现CURD"><a href="#预编译实现CURD" class="headerlink" title="预编译实现CURD"></a>预编译实现CURD</h2><h4 id="TestPreparedStatement-java"><a href="#TestPreparedStatement-java" class="headerlink" title="TestPreparedStatement.java"></a>TestPreparedStatement.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-06 - 07 - 06 - 19:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.test03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPreparedStatement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testAdd(); <span class="comment">//向emp表中增加一条数据</span></span><br><span class="line">        testUpdate();<span class="comment">//根据工号修改员工表中的数据</span></span><br><span class="line">        testDelete();<span class="comment">//根据工号删除员工表中的数据</span></span><br><span class="line">        testQuery();<span class="comment">//查询名字中包含A的员工信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//向emp表中增加一条数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into emp values(DEFAULT,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, <span class="string">&quot;Mark&quot;</span>);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>, <span class="string">&quot;MANAGER&quot;</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">3</span>, <span class="number">7839</span>);</span><br><span class="line">            preparedStatement.setDate(<span class="number">4</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()));</span><br><span class="line">            preparedStatement.setDouble(<span class="number">5</span>, <span class="number">3000.12</span>);</span><br><span class="line">            preparedStatement.setDouble(<span class="number">6</span>, <span class="number">0.0</span>);</span><br><span class="line">            preparedStatement.setDouble(<span class="number">7</span>, <span class="number">30</span>);</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> preparedStatement.executeUpdate();</span><br><span class="line">            System.out.println(<span class="string">&quot;影响行数&quot;</span> + rows);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span>()&#123;&#125;<span class="keyword">finally</span>&#123;&#125; </span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//根据工号修改员工表中的数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update emp set ename =?,job= ? where empno = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>, <span class="string">&quot;ANALYST&quot;</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">3</span>, <span class="number">7777</span>);</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> preparedStatement.executeUpdate();</span><br><span class="line">            System.out.println(<span class="string">&quot;影响行数&quot;</span> + rows);</span><br><span class="line">        &#125;<span class="keyword">catch</span>()&#123;&#125;<span class="keyword">finally</span>&#123;&#125;<span class="comment">//这部分都省略，同下</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//根据工号删除员工表中的数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from emp where empno = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setInt(<span class="number">1</span>, <span class="number">7777</span>);</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> preparedStatement.executeUpdate();</span><br><span class="line">            System.out.println(<span class="string">&quot;影响行数&quot;</span> + rows);</span><br><span class="line">        &#125; <span class="keyword">catch</span>()&#123;&#125;<span class="keyword">finally</span>&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询名字中包含A的员工信息</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp where ename like ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;%A%&quot;</span>);</span><br><span class="line">            resultSet = preparedStatement.executeQuery();</span><br><span class="line">            list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">MGR</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;MGR&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;SAL&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;comm&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">                <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(empno, ename, job, MGR, date, sal, comm, deptno);</span><br><span class="line">                list.add(emp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> () &#123;&#125; <span class="keyword">finally</span> &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span>(Emp e:list)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-批处理"><a href="#5-批处理" class="headerlink" title="5. 批处理"></a>5. 批处理</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>​        当我们有多条sql语句需要发送到数据库执行的时候，有两种发送方式，一种是执行一条发送一条sql语句给数据库,另一个种是发送一个sql集合给数据库，也就是发送一个批sql到数据库。普通的执行过程是：每处理一条数据，就访问一次数据库；而批处理是：累积到一定数量，再一次性提交到数据库，减少了与数据库的交互次数，所以效率会大大提高,很显然两者的数据库执行效率是不同的，我们发送批处理sql的时候数据库执行效率要高</p>
<h2 id="Statement和preparedStatement的批处理区别"><a href="#Statement和preparedStatement的批处理区别" class="headerlink" title="Statement和preparedStatement的批处理区别"></a>Statement和preparedStatement的批处理区别</h2><ul>
<li>statement语句对象实现批处理有如下问题<ul>
<li>缺点：采用硬编码效率低，安全性较差。</li>
<li>原理：硬编码，每次执行时相似SQL都会进行编译  </li>
</ul>
</li>
<li>PreparedStatement+批处理<ul>
<li>优点：语句只编译一次，减少编译次数。提高了安全性（阻止了SQL注入）</li>
<li>原理：相似SQL只编译一次，减少编译次数</li>
</ul>
</li>
</ul>
<h2 id="批处理开启"><a href="#批处理开启" class="headerlink" title="批处理开启"></a>批处理开启</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&amp;rewriteBatchedStatements=true&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>向部门表中增加多条数据</p>
<p>利用循环添加，并每1000为一批，放入之后清除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(default ,?,?)&quot;</span>;</span><br><span class="line">preparedStatement = connection.prepareStatement(sql);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10036</span> i++) &#123;</span><br><span class="line">    preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    preparedStatement.setString(<span class="number">2</span>,<span class="string">&quot;location&quot;</span>);</span><br><span class="line">    <span class="comment">//放进一批里</span></span><br><span class="line">    preparedStatement.addBatch();</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">1000</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//每1000为一批，放入后清除</span></span><br><span class="line">        preparedStatement.executeBatch();</span><br><span class="line">        preparedStatement.clearBatch();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//没有整除完的部分</span></span><br><span class="line">preparedStatement.executeBatch();</span><br><span class="line">preparedStatement.addBatch();</span><br></pre></td></tr></table></figure>

<h1 id="6-JDBC控制事务"><a href="#6-JDBC控制事务" class="headerlink" title="6.JDBC控制事务"></a>6.JDBC控制事务</h1><p>主要是在学习如何让多个数据库操作成为一个整体，实现要么全部执行成功，要么全部都不执行</p>
<p>在JDBC中，事务操作是自动提交，一条对数据库的DML代表一项事务操作</p>
<p>转账的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-08 - 07 - 08 - 16:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.test05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTransaction</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +    <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&amp;useServerPrepStmts=true&amp;cachePrepStmts=true&amp;rewriteBatchedStatements=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testTransaction();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义一个方法，向部门表增加多条数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testTransaction</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update account set balance = balance-? where aid =?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//转出</span></span><br><span class="line">            preparedStatement.setDouble(<span class="number">1</span>,<span class="number">100</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//执行</span></span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line">            <span class="comment">//转入</span></span><br><span class="line">            preparedStatement.setDouble(<span class="number">1</span>,-<span class="number">100</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">            <span class="comment">//执行</span></span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为了保证多个sql语句一起执行，使用事务。</p>
<p>在JDBC中，事务操作是<strong>自动提交</strong>。一条对数据库的DML(insert、update、delete)代表一项事务操作,操作成功后，系统将自动调用commit()提交，否则自动调用rollback()回滚。</p>
<h3 id="设置事务手动提交"><a href="#设置事务手动提交" class="headerlink" title="设置事务手动提交"></a>设置事务手动提交</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="comment">//设置事务手动提交</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update account set balance = balance-? where aid =?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//转出</span></span><br><span class="line">            preparedStatement.setDouble(<span class="number">1</span>,<span class="number">100</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line">   		   <span class="comment">//出现异常</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//转入</span></span><br><span class="line">            preparedStatement.setDouble(<span class="number">1</span>,-<span class="number">100</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//回滚操作</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span>!=connection)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.rollback();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//提交操作</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span>!=connection)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.commit();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置回滚点"><a href="#设置回滚点" class="headerlink" title="设置回滚点"></a>设置回滚点</h3><p>作用是保证回滚点之前的数据更改生效，回滚点以后的数据更改操作就会无效。</p>
<p>并且回滚点的操作值可以进行更改和设置。</p>
<ul>
<li>在增加数据操作里面，每一千设置一个回滚点：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">connection.setAutoCommit(<span class="literal">false</span>);<span class="comment">//设置手动提交</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(default ,?,?)&quot;</span>;</span><br><span class="line">preparedStatement = connection.prepareStatement(sql);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10036</span>; i++) &#123;</span><br><span class="line">    preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    preparedStatement.setString(<span class="number">2</span>,<span class="string">&quot;location&quot;</span>);</span><br><span class="line">    preparedStatement.addBatch();</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">1000</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        preparedStatement.executeBatch();</span><br><span class="line">        preparedStatement.clearBatch();</span><br><span class="line">        <span class="comment">//每一千条设置回滚点</span></span><br><span class="line">        <span class="type">Savepoint</span> <span class="variable">savepoint</span> <span class="operator">=</span> connection.setSavepoint();</span><br><span class="line">        savepoints.addLast(savepoint);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//期间出现异常</span></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">10001</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span><span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">preparedStatement.executeBatch();</span><br><span class="line">preparedStatement.addBatch();</span><br></pre></td></tr></table></figure>

<ul>
<li>出现异常是10000以后，在最后一个回滚点回滚，剩下36则不保留</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获得回滚点集合最后一个点</span></span><br><span class="line">            <span class="type">Savepoint</span> <span class="variable">sp</span> <span class="operator">=</span> savepoints.getLast();</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != sp)&#123;</span><br><span class="line">                connection.rollback(sp);&#125;<span class="comment">//回滚</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li>设置特定的回滚点</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得特定的回滚点</span></span><br><span class="line"><span class="type">Savepoint</span> <span class="variable">sp</span> <span class="operator">=</span> savepoints.get(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<h1 id="7-DAO模式"><a href="#7-DAO模式" class="headerlink" title="7. DAO模式"></a>7. DAO模式</h1><p>项目结构</p>
<ul>
<li><p><strong>实体类</strong>：和数据库表格一一对应的类,单独放入一个包中,包名往往是 pojo/entity/bean,要操作的每个表格都应该有对应的实体类</p>
<ul>
<li><p>emp &gt; class Emp  </p>
<p>dept &gt; class Dept  </p>
<p>account &gt; class Account </p>
</li>
</ul>
</li>
<li><p><strong>DAO层</strong>：定义了对数据要执行那些操作的接口和实现类,包名往往是 dao/mapper,要操作的每个表格都应该有对应的接口和实现类</p>
<ul>
<li><p>emp &gt; interface EmpDao &gt;EmpDaoImpl</p>
<p>dept &gt; interface DeptDao&gt; DeptDaoImpl</p>
</li>
</ul>
</li>
<li><p>Mybatis/Spring-JDBCTemplate 中,对DAO层代码进行了封装,代码编写方式会有其他变化</p>
</li>
</ul>
<p>项目截图</p>
<img src="/2021/06/07/JDBC/20210709153202.png" alt="image-20210709153201647" style="zoom: 50%;">

<h2 id="接口类（DAO层）"><a href="#接口类（DAO层）" class="headerlink" title="接口类（DAO层）"></a>接口类（DAO层）</h2><h3 id="Emp-java-1"><a href="#Emp-java-1" class="headerlink" title="Emp.java"></a>Emp.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-09 - 07 - 09 - 15:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.dao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向数据库Emp表中增加一条数据的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emp 要增加的数据封装成的Emp类的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 增加成功返回大于0的整数，增加失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addEmp</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据员工编号来删除员工信息的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> empno 要删除的员工的编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功返回大于0的整数，删除失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByEmpno</span><span class="params">(<span class="type">int</span> empno)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有员工的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有员工的信息集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据工号修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emp 传入修改的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功返回大于0的整数，删除失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Dept-java"><a href="#Dept-java" class="headerlink" title="Dept.java"></a>Dept.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-09 - 07 - 09 - 15:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.dao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptDao</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有部门信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有部门信息的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加部门信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dept 需要添加的部门信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 增加成功返回大于0的整数，增加失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addDept</span><span class="params">(Dept dept)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现类（未被抽取的）"><a href="#实现类（未被抽取的）" class="headerlink" title="实现类（未被抽取的）"></a>实现类（未被抽取的）</h2><h3 id="EmpDaoImpl-java"><a href="#EmpDaoImpl-java" class="headerlink" title="EmpDaoImpl.java"></a>EmpDaoImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-09 - 07 - 09 - 15:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.dao.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">        <span class="comment">//向emp表中增加一条数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into emp values(DEFAULT,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setObject(<span class="number">1</span>, emp.getEname());</span><br><span class="line">            preparedStatement.setObject(<span class="number">2</span>, emp.getJob());</span><br><span class="line">            preparedStatement.setObject(<span class="number">3</span>, emp.getMgr());</span><br><span class="line">            preparedStatement.setObject(<span class="number">4</span>, emp.getHiredate());</span><br><span class="line">            preparedStatement.setObject(<span class="number">5</span>, emp.getSal());</span><br><span class="line">            preparedStatement.setObject(<span class="number">6</span>, emp.getComm());</span><br><span class="line">            preparedStatement.setObject(<span class="number">7</span>, emp.getDeptno());</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            rows = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteByEmpno</span><span class="params">(<span class="type">int</span> empno)</span> &#123;</span><br><span class="line">        <span class="comment">//根据工号删除员工表中的数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from emp where empno = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setObject(<span class="number">1</span>, empno);</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            rows = preparedStatement.executeUpdate();</span><br><span class="line">            <span class="comment">//设置参数然后今次那</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询名字中包含A的员工信息</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp &quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            resultSet = preparedStatement.executeQuery();</span><br><span class="line">            list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;job&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">MGR</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;MGR&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;hiredate&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;SAL&quot;</span>);</span><br><span class="line">                <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> resultSet.getDouble(<span class="string">&quot;comm&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">                <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(empno, ename, job, MGR, date, sal, comm, deptno);</span><br><span class="line">                list.add(emp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != resultSet) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">        <span class="comment">//向emp表中增加一条数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update emp set ename = ?,job = ?,mgr = ?,hiredate=?,sal=?,comm=? ,deptno = ? where empno = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setObject(<span class="number">1</span>, emp.getEname());</span><br><span class="line">            preparedStatement.setObject(<span class="number">2</span>, emp.getJob());</span><br><span class="line">            preparedStatement.setObject(<span class="number">3</span>, emp.getMgr());</span><br><span class="line">            preparedStatement.setObject(<span class="number">4</span>, emp.getHiredate());</span><br><span class="line">            preparedStatement.setObject(<span class="number">5</span>, emp.getSal());</span><br><span class="line">            preparedStatement.setObject(<span class="number">6</span>, emp.getComm());</span><br><span class="line">            preparedStatement.setObject(<span class="number">7</span>, emp.getDeptno());</span><br><span class="line">            preparedStatement.setObject(<span class="number">8</span>,emp.getEmpno());</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            rows = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这些操作都很多相似的地方，可以被抽取成为一个总的类，所以可以啊看待</p>
<h3 id="DeptDaoImpl-java"><a href="#DeptDaoImpl-java" class="headerlink" title="DeptDaoImpl.java"></a>DeptDaoImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-09 - 07 - 09 - 15:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.dao.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mytestdb?&quot;</span> +</span><br><span class="line">            <span class="string">&quot;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//查询名字中包含A的员工信息</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;Dept&gt; list = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from dept &quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            resultSet = preparedStatement.executeQuery();</span><br><span class="line">            list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;deptno&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">dname</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;dname&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">loc</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;loc&quot;</span>);</span><br><span class="line">                <span class="type">Dept</span> <span class="variable">dept</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>(deptno,dname,loc);</span><br><span class="line">                list.add(dept);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != resultSet) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addDept</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">        <span class="comment">//向emp表中增加一条数据</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            forName(driver);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(?,?,?)&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            preparedStatement.setObject(<span class="number">1</span>,dept.getDeptno());</span><br><span class="line">            preparedStatement.setObject(<span class="number">2</span>,dept.getDname());</span><br><span class="line">            preparedStatement.setObject(<span class="number">3</span>,dept.getLoc());</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            rows = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="员工管理系统"><a href="#员工管理系统" class="headerlink" title="员工管理系统"></a>员工管理系统</h2><h3 id="EmpManageSystem-java"><a href="#EmpManageSystem-java" class="headerlink" title="EmpManageSystem.java"></a>EmpManageSystem.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ChanHuiShan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2021-07-09 - 07 - 09 - 20:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: com.chs.view</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManageSystem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">EmpDao</span> <span class="variable">empDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DeptDao deptDao= <span class="keyword">new</span> <span class="title class_">DeptDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;<span class="comment">//控制台循环打印</span></span><br><span class="line">            showMenu();</span><br><span class="line">            System.out.println(<span class="string">&quot;请用户录入选项&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">            <span class="keyword">switch</span> (i)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    case1();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    case2();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    case3();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    case4();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    case5();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    case6();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;请输入1-7的数字！！！&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showMenu</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;1.查看所有员工的信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;2.查看所有部门信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;3.根据工号删除员工信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;4.根据工号修改员工信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5.增加员工信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;6.增加部门信息&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//查看所有员工的信息</span></span><br><span class="line">        List&lt;Emp&gt; list = empDao.findAll();</span><br><span class="line">        <span class="comment">/*for (Emp e: list)&#123;</span></span><br><span class="line"><span class="comment">            System.out.println(e);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//查看所有部门的信息</span></span><br><span class="line">        List&lt;Dept&gt; list = deptDao.findAll();</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//根据工号来删除员工信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入要删除员工的工号：&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> empDao.deleteByEmpno(i);</span><br><span class="line">        <span class="keyword">if</span> (i1!=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除成功！&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case4</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//根据员工工号修改员工信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的编号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">empno</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的姓名&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的工作&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的上级编号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mgr</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的聘用日期（格式为yyyy-mm-dd）&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">hiredate</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//把参数从try代码块里拿出来初始化，因为创建对象的时候会访问不到这个值</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            hiredate = simpleDateFormat.parse(sc.next());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请按照格式输入!!!&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的薪资&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> sc.nextDouble();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的奖金&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> sc.nextDouble();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的部门编号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(empno,ename,job,mgr,hiredate,sal,comm,deptno);</span><br><span class="line">        empDao.updateEmp(emp);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case5</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//添加员工信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的姓名&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的工作&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的上级编号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mgr</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的聘用日期（格式为yyyy-mm-dd）&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">hiredate</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//把参数从try代码块里拿出来初始化，因为创建对象的时候会访问不到这个值</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            hiredate = simpleDateFormat.parse(sc.next());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请按照格式输入!!!&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的薪资&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> sc.nextDouble();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的奖金&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">comm</span> <span class="operator">=</span> sc.nextDouble();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入员工的部门编号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>,ename,job,mgr,hiredate,sal,comm,deptno);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> empDao.addEmp(emp);</span><br><span class="line">        <span class="keyword">if</span> (i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加失败！！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">case6</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//添加部门信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入部门号&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">deptno</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入部门名称&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">dname</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;*请输入部门地址&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loc</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        <span class="type">Dept</span> <span class="variable">dept</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>(deptno, dname, loc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> deptDao.addDept(dept);</span><br><span class="line">        <span class="keyword">if</span> (i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加失败！！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="BaseDao抽取"><a href="#BaseDao抽取" class="headerlink" title="BaseDao抽取"></a>BaseDao抽取</h2><p>由上面实现类的代码可以看到增删改查方法的代码都很相似，其实可以把相似的部分抽取出来称为一个BaseDao的类</p>
<h3 id="增删改的抽取–baseUpdate"><a href="#增删改的抽取–baseUpdate" class="headerlink" title="增删改的抽取–baseUpdate"></a>增删改的抽取–baseUpdate</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增删改方法的抽取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 传入的sql语句对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 传入的可变参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功返回大于0的数，返回失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">baseUpdate</span><span class="params">(String sql,Object ... args)</span>&#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        forName(driver);</span><br><span class="line">        connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">        preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">        <span class="comment">//设置参数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">            preparedStatement.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行CURD</span></span><br><span class="line">        rows = preparedStatement.executeUpdate();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                preparedStatement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查询的抽取–baseQuery"><a href="#查询的抽取–baseQuery" class="headerlink" title="查询的抽取–baseQuery"></a>查询的抽取–baseQuery</h3><p>通过<strong>反射</strong>获取传入字节码的对象属性</p>
<p>关于<strong>反射是否破坏封装类</strong>（面试）：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wk-missQ1/p/13304329.html">https://www.cnblogs.com/wk-missQ1/p/13304329.html</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询操作的抽取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 传入字节码以便通过反射获得对象的属性，</span></span><br><span class="line"><span class="comment">     *              因为不知道具体会传入什么对象里面是什么属性。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 传入的sql语句对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 一些可变的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个查询结果集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List <span class="title function_">baseQuery</span><span class="params">(Class clazz,String sql,Object ... args)</span>&#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        forName(driver);</span><br><span class="line">        connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">        preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">        list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置参数 -- 这里要注意呀</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">            preparedStatement.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行CURD</span></span><br><span class="line">        resultSet = preparedStatement.executeQuery();</span><br><span class="line">        <span class="comment">//通过字节码获取对象的属性</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="comment">//获取访问封装类属性的权限--设置为true可以访问</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">            <span class="comment">//通过反射创建对象</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();<span class="comment">//默认通过反射调用对象的空参构造方法</span></span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();<span class="comment">//先将属性名字获得</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">data</span> <span class="operator">=</span> resultSet.getObject(name);<span class="comment">//通过属性名从结果集中获得</span></span><br><span class="line">                field.set(data,obj);<span class="comment">//将数据放入对象中</span></span><br><span class="line">            &#125;</span><br><span class="line">            list.add(obj);<span class="comment">//将对象加入到链表集合里</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != resultSet) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                preparedStatement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != connection) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置参数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">    preparedStatement.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行CURD</span></span><br><span class="line">resultSet = preparedStatement.executeQuery();</span><br><span class="line"><span class="comment">//通过字节码获取对象的属性</span></span><br><span class="line">Field[] fields = clazz.getDeclaredFields();</span><br><span class="line"><span class="comment">//获取访问封装类属性的权限--设置为true可以访问</span></span><br><span class="line"><span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">    field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">    <span class="comment">//通过反射创建对象</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();<span class="comment">//默认通过反射调用对象的空参构造方法</span></span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();<span class="comment">//先将属性名字获得</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">data</span> <span class="operator">=</span> resultSet.getObject(name);<span class="comment">//通过属性名从结果集中获得</span></span><br><span class="line">        field.set(data,obj);<span class="comment">//将数据放入对象中</span></span><br><span class="line">    &#125;</span><br><span class="line">    list.add(obj);<span class="comment">//将对象放入list表中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样一来，两个实现类中间的增删改操作就可以被简化</p>
<h3 id="实现类简化结果"><a href="#实现类简化结果" class="headerlink" title="实现类简化结果"></a>实现类简化结果</h3><h4 id="DeptDaoImpl-java-1"><a href="#DeptDaoImpl-java-1" class="headerlink" title="DeptDaoImpl.java"></a>DeptDaoImpl.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span> <span class="keyword">implements</span> <span class="title class_">DeptDao</span> &#123;<span class="comment">//注意继承BaseDao</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from dept &quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> baseQuery(Dept.class,sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addDept</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into dept values(?,?,?)&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> baseUpdate(sql,dept.getDeptno(),dept.getDname(),</span><br><span class="line">                    dept.getLoc());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="EmpDaoImpl-java-1"><a href="#EmpDaoImpl-java-1" class="headerlink" title="EmpDaoImpl.java"></a>EmpDaoImpl.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into emp values(DEFAULT,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> baseUpdate(sql,emp.getEname(),emp.getJob(),emp.getMgr(),</span><br><span class="line">                    emp.getHiredate(),emp.getSal(),emp.getComm(),emp.getDeptno());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteByEmpno</span><span class="params">(<span class="type">int</span> empno)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from emp where empno = ?&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> baseUpdate(sql,empno);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from emp &quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> baseQuery(Emp.class,sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update emp set ename = ?,job = ?,mgr = ?,hiredate=?,sal=?,comm=? ,deptno = ? where empno = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> baseUpdate(sql,emp.getEname(),emp.getJob(),emp.getMgr(),</span><br><span class="line">                emp.getHiredate(),emp.getSal(),emp.getComm(),emp.getDeptno(),emp.getEmpno());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="错误总结："><a href="#错误总结：" class="headerlink" title="错误总结："></a>错误总结：</h4><p><strong>java.lang.IllegalArgumentException</strong>：传入参数传错了</p>
<img src="/2021/06/07/JDBC/20210711103201.png" alt="image-20210711103159768" style="zoom:50%;">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">field.set(obj,data);<span class="comment">//将数据放入对象中,不要传反了</span></span><br></pre></td></tr></table></figure>

<h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><ul>
<li><p>传统的连接：</p>
<p>​    首先调用Class.forName()方法加载数据库驱动，然后调用DriverManager.getConnection()方法建立连接.</p>
<ul>
<li><p>缺点：</p>
<p>​    Connection对象在每次执行DML和DQL的过程中都要创建一次,DML和DQL执行完毕后,connection对象都会被销毁. connection对象是可以反复使用的,没有必要每次都创建新的.该对象的创建和销毁都是比较消耗系统资源的,如何实现connection对象的反复使用呢?使用连接池技术实现.   </p>
</li>
</ul>
</li>
<li><p>使用连接池：</p>
<ul>
<li><p>预先准备一些链接对象,放入连接池中,当多个线程并发执行时,可以避免短时间内一次性大量创建链接对象,减少计算机单位时间内的运算压力,提高程序的响应速度</p>
</li>
<li><p>实现链接对象的反复使用,可以大大减少链接对象的创建次数,减少资源的消耗</p>
</li>
</ul>
</li>
</ul>
<p>MyConnectionPool.java</p>
<ul>
<li><p>创建一个连接对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//准备一个池子装连接对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LinkedList&lt;Connection&gt; pool;</span><br></pre></td></tr></table></figure></li>
<li><p>静态代码块</p>
<ul>
<li>加载驱动</li>
<li>初始化pool</li>
<li>创建5个链接对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用静态代码块加载驱动，创建连接</span></span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">    <span class="comment">//加载驱动</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//初始化pool</span></span><br><span class="line">    pool = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//创建五个链接对象</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; initSize; i++) &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> initConnection();</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != connection)&#123;</span><br><span class="line">            pool.add(connection);</span><br><span class="line">            System.out.println(<span class="string">&quot;初始化连接：&quot;</span>+connection.hashCode()+<span class="string">&quot;放入连接池&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>私有的初始化一个链接对象的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 私有的初始化一个链接对象的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 初始化的连接对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title function_">initConnection</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(url,user,password);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>公有的向外界提供链接对象</p>
<ul>
<li>如果池子里有对象<ul>
<li>remove（）</li>
</ul>
</li>
<li>如果池子没了：创建新的对象</li>
<li>最后返回对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 公有的向外界提供链接对象的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (pool.size()&gt;<span class="number">0</span>)&#123;<span class="comment">//如果连接池里面有元素</span></span><br><span class="line">        connection = pool.remove();<span class="comment">//移出集合中的第一个元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;连接池中还有链接，获得链接：&quot;</span>+connection.hashCode());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        connection = initConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;连接池为空，创建新链接：&quot;</span>+connection);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> connection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>公有的向链接对象归还链接对象的方法</p>
<ul>
<li>若链接没有被关闭<ul>
<li>调整事务状态，设置为手动提交</li>
<li>容量小于最大容量<ul>
<li>池子最后加上connection</li>
</ul>
</li>
<li>容量达到最大容量<ul>
<li>关闭连接，打印池子满了，关闭连接</li>
</ul>
</li>
</ul>
</li>
<li>若已经被关闭，打印：无需关闭，不用归还</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 公有的向链接对象归还链接对象的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">returnConnection</span><span class="params">(Connection connection)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != connection)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!connection.isClosed())</span><br><span class="line">                <span class="keyword">if</span> (pool.size()&lt; maxSize)&#123;</span><br><span class="line">                    connection.setAutoCommit(<span class="literal">true</span>);<span class="comment">//调整事务状态</span></span><br><span class="line">                    pool.addLast(connection);<span class="comment">//归还链接对象给池子</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;连接池未满，归还链接对象：&quot;</span>+connection.hashCode());</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                    System.out.println(<span class="string">&quot;连接池已满，关闭连接池&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;连接已经关闭无需归还&quot;</span>);<span class="comment">//连接被关了下次是没法用的</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;传入的连接为null，无需归还&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ol>
<li><p>创建多个连接：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">connection1</span> <span class="operator">=</span> MyConnectionPool.getConnection();</span><br><span class="line">...</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection11</span> <span class="operator">=</span> MyConnectionPool.getConnection();</span><br></pre></td></tr></table></figure>

<p>结果：前面小于initSize的部分个从连接池里取，后面超过的部分直接初始化。</p>
<img src="/2021/06/07/JDBC/20210711185528.png" style="zoom:50%;"></li>
<li><p>归还连接</p>
<ol>
<li><p>传入null值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyConnectionPool.returnConnection(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2021/06/07/JDBC/20210711190848.png" alt="image-20210711190848341" style="zoom:50%;"></li>
<li><p>传入已关闭的连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">connection1.close();</span><br><span class="line">MyConnectionPool.returnConnection(connection1);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2021/06/07/JDBC/20210711190953.png" alt="image-20210711190953769" style="zoom: 67%;"></li>
<li><p>传入超过maxSize的连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyConnectionPool.returnConnection(connection11);<span class="comment">//maxSize=10---11&gt;10</span></span><br></pre></td></tr></table></figure>

<img src="/2021/06/07/JDBC/20210711191448.png" alt="image-20210711191448052" style="zoom:50%;"></li>
</ol>
</li>
</ol>
<h3 id="BaseDao改进"><a href="#BaseDao改进" class="headerlink" title="BaseDao改进"></a>BaseDao改进</h3><ul>
<li><p>原来的参数可以删除</p>
<img src="/2021/06/07/JDBC/20210711192110.png" alt="image-20210711192110111" style="zoom: 50%;"></li>
<li><p>加载驱动和连接部分改进</p>
<img src="/2021/06/07/JDBC/20210711192336.png" alt="image-20210711192335963" style="zoom: 67%;"></li>
<li><p>连接最后归还</p>
<img src="/2021/06/07/JDBC/20210711192550.png" alt="image-20210711192550600" style="zoom:50%;"></li>
</ul>
<h4 id="BaseDao-java"><a href="#BaseDao-java" class="headerlink" title="BaseDao.java"></a>BaseDao.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseDao</span> &#123;</span><br><span class="line">    <span class="comment">//原来的参数全部删除</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增删改方法的抽取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 传入的sql语句对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 传入的可变参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功返回大于0的数，返回失败返回0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">baseUpdate</span><span class="params">(String sql,Object ... args)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rows= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = MyConnectionPool.getConnection();<span class="comment">//从连接池里获得连接</span></span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);<span class="comment">//这个时候就要传入语句对象</span></span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">                preparedStatement.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            rows = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            MyConnectionPool.returnConnection(connection);<span class="comment">//归还到连接池里</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询操作的抽取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 传入字节码以便通过反射获得对象的属性，</span></span><br><span class="line"><span class="comment">     *              因为不知道具体会传入什么对象里面是什么属性。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 传入的sql语句对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args 一些可变的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个查询结果集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List <span class="title function_">baseQuery</span><span class="params">(Class clazz,String sql,Object ... args)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = MyConnectionPool.getConnection();</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//设置参数</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">                preparedStatement.setObject(i+<span class="number">1</span>,args[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//执行CURD</span></span><br><span class="line">            resultSet = preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//通过字节码获取对象的属性</span></span><br><span class="line">            Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">            <span class="comment">//获取访问封装类属性的权限--设置为true可以访问</span></span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">               field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="comment">//通过反射创建对象</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();<span class="comment">//默认通过反射调用对象的空参构造方法</span></span><br><span class="line">                <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();<span class="comment">//先将属性名字获得</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">data</span> <span class="operator">=</span> resultSet.getObject(name);<span class="comment">//通过属性名从结果集中获得</span></span><br><span class="line">                    field.set(obj,data);<span class="comment">//将数据放入对象中</span></span><br><span class="line">                &#125;</span><br><span class="line">                list.add(obj);<span class="comment">//将对象加入到链表集合里</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != resultSet) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != preparedStatement) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            MyConnectionPool.returnConnection(connection);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置文件优化连接池"><a href="#配置文件优化连接池" class="headerlink" title="配置文件优化连接池"></a>配置文件优化连接池</h2><img src="/2021/06/07/JDBC/20210711193622.png" alt="image-20210711193622546" style="zoom: 50%;">

<p>注意格式：空格不能随便加</p>
<img src="/2021/06/07/JDBC/20210711193523.png" alt="image-20210711193523624" style="zoom:50%;">

<h3 id="PropertiesUtil工具类"><a href="#PropertiesUtil工具类" class="headerlink" title="PropertiesUtil工具类"></a>PropertiesUtil工具类</h3><ul>
<li>创建工具类<ul>
<li>定义构造方法<ul>
<li>传进配置文件的路径</li>
<li>通过字节码获取文件路径</li>
<li>加载IO流</li>
</ul>
</li>
<li>定义一个获得参数的方法</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;<span class="comment">//定义配置文件参数</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义配置文件构造器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 传入配置文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PropertiesUtil</span><span class="params">(String path)</span>&#123;</span><br><span class="line">        properties = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//通过字节码获取IO流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getResourceAsStream(path);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//加载IO流</span></span><br><span class="line">            properties.load(resourceAsStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回配置文件参数值的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 参数名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 参数的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProperties</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties.getProperty(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="连接池优化"><a href="#连接池优化" class="headerlink" title="连接池优化"></a>连接池优化</h3><ul>
<li><p>删除参数值 </p>
<img src="/2021/06/07/JDBC/20210712101026.png" alt="image-20210712101026751" style="zoom:50%;"></li>
<li><p>在静态代码块里配置参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建配置文件对象</span></span><br><span class="line"><span class="type">PropertiesUtil</span> <span class="variable">propertiesUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertiesUtil</span>(<span class="string">&quot;/jdbc.properties&quot;</span>);</span><br><span class="line">driver = propertiesUtil.getProperties(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">url = propertiesUtil.getProperties(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">user = propertiesUtil.getProperties(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">password = propertiesUtil.getProperties(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">initSize = Integer.parseInt(propertiesUtil.getProperties(<span class="string">&quot;initSize&quot;</span>));</span><br><span class="line">maxSize = Integer.parseInt(propertiesUtil.getProperties(<span class="string">&quot;maxSize&quot;</span>));</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="错误总结"><a href="#错误总结" class="headerlink" title="错误总结"></a>错误总结</h3><p>连接池的定义好像出现了某种问题</p>
<p>Exception in thread “main” java.lang.NoClassDefFoundError: Could not initialize class com.chs.dao.MyConnectionPool</p>
<p>发现是构造器中没有用到本身的参数，而是重新定义了一个参数：</p>
<img src="/2021/06/07/JDBC/20210712110521.png" alt="image-20210712110521532" style="zoom: 67%;">



<h1 id="8-log4j日志"><a href="#8-log4j日志" class="headerlink" title="8. log4j日志"></a>8. log4j日志</h1><ol>
<li><p>什么是日志log</p>
<p>​        异常信息  登录成功失败的信息  其他重要操作的信息，日志可以记录程序的运行状态,运行信息,用户的一些常用操作.日志可以帮助我们分析程序的运行状态,帮我们分析用户的操作习惯,进而对程序进行改</p>
</li>
<li><p>如何记录日志</p>
<ul>
<li><p>方式1：System.out.println(…..)    e.printStackTrace();</p>
<p>缺点：不是保存到文件，不能长久存储</p>
</li>
<li><p>方式2：IO流 将System.out.println(…..)  e.printStackTrace();写入文件</p>
<p>缺点：操作繁琐,IO流操作容易阻塞线程,日志没有等级,日志的格式不能很好的定制,要想实行编程复杂</p>
</li>
<li><p>方式3：使用现成的日志框架，比如log4j</p>
<p>优点：1长久保存 2有等级3格式可以很好的定制 4代码编写简单</p>
</li>
</ul>
</li>
<li><p>log4j日志的级别</p>
<pre><code>FATAL：  指出现非常严重的错误事件，这些错误可能导致应用程序异常中止
ERROR： 指虽有错误，但仍允许应用程序继续运行
WARN：  指运行环境潜藏着危害
INFO：    指报告信息，这些信息在粗粒度级别上突出显示应用程序的进程
DEBUG： 指细粒度信息事件，对于应用程序的调试是最有用的
</code></pre>
</li>
<li><p>使用log4j记录日志</p>
<ul>
<li><p>加入jar包   <strong>log4j-1.2.8.jar</strong></p>
<img src="/2021/06/07/JDBC/20210712120555.png" alt="image-20210712120555879" style="zoom:50%;"></li>
<li><p>加入属性文件 src 下 <strong>log4j.properties</strong></p>
<img src="/2021/06/07/JDBC/20210712120643.png" alt="image-20210712120643129" style="zoom:50%;">

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">error,logfile</span></span><br><span class="line"><span class="comment">## 方式一：打印到控制台</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.SimpleLayout</span></span><br><span class="line"><span class="comment">## 方式二：打印到logfile文件</span></span><br><span class="line"><span class="attr">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.File</span>=<span class="string">d:/msb.log</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d&#123;yyyy-MM-dd   HH:mm:ss&#125; %l %F %p %m%n</span></span><br></pre></td></tr></table></figure>

<img src="/2021/06/07/JDBC/20210712124734.png" alt="image-20210712124734548" style="zoom: 67%;">

<img src="/2021/06/07/JDBC/20210712125136.png" alt="image-20210712125136115" style="zoom:50%;"></li>
<li><p>通过属性文件理解log4j的主要API</p>
<p>Appender 日志目的地 :ConsoleAppender  FileAppender</p>
<p>Layout 日志格式化器 ：SimpleLayout  PatternLayout</p>
</li>
</ul>
</li>
</ol>
<h3 id="以连接池为例："><a href="#以连接池为例：" class="headerlink" title="以连接池为例："></a>以连接池为例：</h3><ul>
<li><p>添加日志对象</p>
<img src="/2021/06/07/JDBC/20210712122737.png" alt="image-20210712122736926" style="zoom:50%;"></li>
<li><p>初始化日志</p>
<img src="/2021/06/07/JDBC/20210712123200.png" alt="image-20210712123159994" style="zoom:50%;"></li>
<li><p>将sout语句和错误打印改为日志输出：</p>
<ul>
<li>错误大多使用fatal级别</li>
</ul>
<img src="/2021/06/07/JDBC/20210712124134.png" alt="image-20210712124134859" style="zoom:50%;">

<ul>
<li>sout提示语句一般使用info级别</li>
</ul>
<img src="/2021/06/07/JDBC/20210712124306.png" alt="image-20210712124306011" style="zoom:50%;">

<p>运行结果：</p>
<img src="/2021/06/07/JDBC/20210712124525.png" alt="image-20210712124525739" style="zoom:67%;"></li>
</ul>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%p：输出日志信息的优先级，即DEBUG，INFO，WARN，ERROR，FATAL。</span><br><span class="line">%d：输出日志时间点的日期或时间，默认格式为ISO8601，也可以在其后指定格式，如：%d&#123;yyyy/MM/dd HH:mm:ss,SSS&#125;。</span><br><span class="line">%r：输出自应用程序启动到输出该log信息耗费的毫秒数。</span><br><span class="line">%t：输出产生该日志事件的线程名。</span><br><span class="line">%l：输出日志事件的发生位置，相当于%c.%M(%F:%L)的组合，包括类全名、方法、文件名以及在代码中的行数。例如</span><br><span class="line">test.TestLog4j.main(TestLog4j.java:10)。</span><br><span class="line">%c：输出日志信息所属的类目，通常就是所在类的全名。</span><br><span class="line">%M：输出产生日志信息的方法名。</span><br><span class="line">%F：输出日志消息产生时所在的文件名称。</span><br><span class="line">%L:：输出代码中的行号。</span><br><span class="line">%m:：输出代码中指定的具体日志信息。</span><br><span class="line">%n：输出一个回车换行符，Windows平台为&quot;rn&quot;，Unix平台为&quot;n&quot;。</span><br><span class="line">%x：输出和当前线程相关联的NDC(嵌套诊断环境)，尤其用到像java servlets这样的多客户多线程的应用中。</span><br><span class="line">%%：输出一个&quot;%&quot;字符。</span><br></pre></td></tr></table></figure>



<h1 id="9-三大范式"><a href="#9-三大范式" class="headerlink" title="9. 三大范式"></a>9. 三大范式</h1><h2 id="第一范式（1NF）"><a href="#第一范式（1NF）" class="headerlink" title="第一范式（1NF）"></a><strong>第一范式（1NF）</strong></h2><p><strong>要求数据库表的每一列都是不可分割的原子数据项。</strong></p>
<p>举例说明：</p>
<img src="/2021/06/07/JDBC/20210712153337.png" alt="img" style="zoom:67%;">

<p>在上面的表中，“家庭信息”和“学校信息”列均不满足原子性的要求，故不满足第一范式，调整如下：</p>
<img src="/2021/06/07/JDBC/20210712153335.png" alt="img" style="zoom:67%;">

<p>可见，调整后的每一列都是不可再分的，因此满足第一范式（1NF）；</p>
<h2 id="第二范式（2NF）"><a href="#第二范式（2NF）" class="headerlink" title="第二范式（2NF）"></a><strong>第二范式（2NF）</strong></h2><p><strong>在1NF的基础上，非码属性必须完全依赖于候选码（在1NF基础上消除非主属性对主码的部分函数依赖）</strong></p>
<p><strong>第二范式需要确保数据库表中的每一列都和主键相关，而不能只与主键的某一部分相关（主要针对联合主键而言）。</strong></p>
<p>举例说明：</p>
<img src="/2021/06/07/JDBC/20210712153333.png" alt="img" style="zoom:67%;">

<p>在上图所示的情况中，同一个订单中可能包含不同的产品，因此主键必须是“订单号”和“产品号”联合组成，</p>
<p>但可以发现，产品数量、产品折扣、产品价格与“订单号”和“产品号”都相关，但是订单金额和订单时间仅与“订单号”相关，与“产品号”无关，</p>
<p>这样就不满足第二范式的要求，调整如下，需分成两个表：</p>
<p> <img src="/2021/06/07/JDBC/20210712153328.png" alt="img" style="zoom:67%;"> <img src="/2021/06/07/JDBC/20210712153331.png" alt="img" style="zoom:67%;"></p>
<h2 id="第三范式（3NF）"><a href="#第三范式（3NF）" class="headerlink" title="第三范式（3NF）"></a><strong>第三范式（3NF）</strong></h2><p><strong>在2NF基础上，任何非主<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B1%9E%E6%80%A7">属性</a>不依赖于其它非主属性（在2NF基础上消除传递依赖）</strong></p>
<p><strong>第三范式需要确保数据表中的每一列数据都和主键直接相关，而不能间接相关。</strong></p>
<p>举例说明：</p>
<img src="/2021/06/07/JDBC/20210712153325.png" alt="img" style="zoom:67%;">

<p>上表中，所有属性都完全依赖于学号，所以满足第二范式，但是“班主任性别”和“班主任年龄”直接依赖的是“班主任姓名”，</p>
<p>而不是主键“学号”，所以需做如下调整：</p>
<p><img src="/2021/06/07/JDBC/20210712153312.png" alt="img" style="zoom:67%;"> <img src="/2021/06/07/JDBC/20210712153317.png" alt="img" style="zoom:67%;"></p>
<p>这样以来，就满足了第三范式的要求。</p>
<p>ps:如果把上表中的班主任姓名改成班主任教工号可能更确切，更符合实际情况，不过只要能理解就行。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>优点：结构合理、冗余较小、尽量避免插入删除修改异常</li>
</ul>
<ul>
<li><p>缺点：性能降低、多表查询比单表查询速度慢。</p>
</li>
<li><p>范式是指导数据设计的规范化理论，可以保证数据库设计质量</p>
<ul>
<li>第一范式：字段不能再分</li>
<li>第二范式：不存在局部依赖</li>
<li>第三范式：不含传递依赖（间接依赖）</li>
</ul>
</li>
<li><p>在实际设计中，要整体遵循范式理论，但某些特定的情况下不能死板遵循，这样会降低数据库的效率，一般单表查询效率会比多表查询高，特定表的的设计可以违反第三范式，增加冗余提高性能</p>
<ul>
<li>例如：经常购物车条目的中除了条目编号，商品编号，商品数量外，可以增加经常使用的商品名称，商品价格等</li>
<li><img src="/2021/06/07/JDBC/20210712154207.png" alt="image-20210712154207006" style="zoom:50%;"></li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://blog.csdn.net/weixin_43633620?spm=1000.2115.3001.5343">
          <span class="icon">
            <i class="fab fa-twitter"></i>
          </span>

          <span class="label">CSDN</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/JDBC/" rel="tag"># JDBC</a>
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/DataBase/" rel="tag"># DataBase</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/07/MySQL/" rel="prev" title="MySQL">
                  <i class="fa fa-chevron-left"></i> MySQL
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/06/13/HTML/" rel="next" title="HTML">
                  HTML <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sonia33</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>




    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div id="moon-menu-item-back2bottom" class="moon-menu-item">
      <i class='fas fa-chevron-down'></i>    </div>
    
    <div id="moon-menu-item-back2top" class="moon-menu-item">
      <i class='fas fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>